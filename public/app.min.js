let{room:room,name:name,autoJoin:autoJoin}=Qs.parse(location.search,{ignoreQueryPrefix:!0});room||(window.location="/");const socket=io();let chatAutoClose,tick,canvas=document.getElementsByClassName("whiteboard")[0],colors=document.querySelector(".colors"),context=canvas.getContext("2d"),user=document.getElementsByClassName("user")[0],clear=document.querySelector(".clear"),lock=document.querySelector(".lock"),fill=document.querySelector(".fill"),toolbarButtons=document.querySelector(".buttons"),brushSizeControl=document.getElementById("brushSize"),playerList=document.querySelector(".player-count .dropdown ul"),firstRunOpen=!0,firstRnPhase=1,firstRnStartBtn=document.querySelector("#first-run .start-fr"),firstRnHeader=document.querySelector("#first-run .modal__title"),firstRnContent=document.querySelector("#first-run .modal__content"),settingsIcon=document.querySelector(".settings"),justDrawBtn=document.querySelector(".just-draw"),brushSize=10,userJoined=!1,usersInCall=document.querySelector(".calls .btn-label p"),isTickMuted="true"===localStorage.getItem("sddMute");const roundDuration=60,waitTime=10,minUsersNeededForVoting=2;brushSizeControl.value=brushSize,feather.replace();let id="2412",getIndex=e=>Math.floor(Math.random()*(e-0))+0;function joinRoom(e){socket.emit("joinRoom",{room:{id:room,canvas:[],users:[],colls:"",lastCollision:Date.now(),created:Date.now(),locked:!1,bg:"white",game:{justDraw:!1,currentlyDrawing:"",round:0,timer:0,ranks:{},rounds:{},alreadyDrawn:[]}},userName:e})}socket.on("connect",()=>{if(name)joinRoom(name);else{let e=["admiral","agent-s","agnes","al","alfonso","alice","alli","amelia","anabelle","anchovy","angus","anicotti","ankha","annalisa","annalise","antonio","apollo","apple","astrid","audie","aurora","ava","avery","axel","baabara","bam","bangle","barold","bea","beardo","beau","becky","bella","benedict","benjamin","bertha","bettina","bianca","biff","big-top","bill","billy","biskit","bitty","blaire","blanche","bluebear","bob","bonbon","bones","boomer","boone","boots","boris","boyd","bree","broccolo","broffina","bruce","bubbles","buck","bud","bunnie","butch","buzz","cally","camofrog","canberra","candi","carmen","caroline","carrie","cashmere","celia","cesar","chadder","charlise","cheri","cherry","chester","chevre","chief","chops","chow","chrissy","claude","claudia","clay","cleo","clyde","coach","cobb","coco","cole","colton","cookie","cousteau","cranston","croque","cube","curlos","curly","curt","cyd","cyrano","daisy","deena","deirdre","del","deli","derwin","diana","diva","dizzy","dobie","doc","dom","dora","dotty","drago","drake","drift","ed","egbert","elise","ellie","elmer","eloise","elvis","erik","eugene","eunice","fang","fauna","felicity","filbert","flip","flo","flora","flurry","francine","frank","freckles","freya","friga","frita","frobert","fuchsia","gabi","gala","gaston","gayle","genji","gigi","gladys","gloria","goldie","gonzo","goose","graham","greta","grizzly","groucho","gruff","gwen","hamlet","hamphrey","hans","harry","hazel","henry","hippeux","hopkins","hopper","hornsby","huck","hugh","iggly","ike","jacob","jacques","jambette","jay","jeremiah","jitters","joey","judy","julia","julian","june","kabuki","katt","keaton","ken","ketchup","kevin","kid-cat","kidd","kiki","kitt","kitty","klaus","knox","kody","kyle","leonardo","leopold","lily","limberg","lionel","lobo","lolly","lopez","louie","lucha","lucky","lucy","lyman","mac","maddie","maelle","maggie","mallary","maple","marcel","marcie","margie","marina","marshal","mathilda","megan","melba","merengue","merry","midge","mint","mira","miranda","mitzi","moe","molly","monique","monty","moose","mott","muffy","murphy","nan","nana","naomi","nate","nibbles","norma","o'hare","octavian","olaf","olive","olivia","opal","ozzie","pancetti","pango","paolo","papi","pashmina","pate","patty","paula","peaches","peanut","pecan","peck","peewee","peggy","pekoe","penelope","phil","phoebe","pierce","pietro","pinky","piper","pippy","plucky","pompom","poncho","poppy","portia","prince","puck","puddles","pudge","punchy","purrl","queenie","quillson","raddle","rasher","raymond","renÃ©e","reneigh","rex","rhonda","ribbot","ricky","rizzo","roald","robin","rocco","rocket","rod","rodeo","rodney","rolf","rooney","rory","roscoe","rosie","rowan","ruby","rudy","sally","samson","sandy","savannah","scoot","shari","sheldon","shep","sherb","simon","skye","sly","snake","snooty","soleil","sparro","spike","spork","sprinkle","sprocket","static","stella","sterling","stinky","stitches","stu","sydney","sylvana","sylvia","t-bone","tabby","tad","tammi","tammy","tangy","tank","tasha","teddy","tex","tia","tiffany","timbra","tipper","tom","truffles","tucker","tutu","twiggy","tybalt","ursala","velma","vesta","vic","victoria","violet","vivian","vladimir","wade","walker","walt","wart-jr","weber","wendy","whitney","willow","winnie","wolfgang","yuka","zell","zucker"];joinRoom("rando-"+e[getIndex(e.length)])}}),socket.on("newId",e=>{let{user:t,room:o}=e,n=document.querySelector(".user");n.id=t.id,n.style.backgroundColor=t.avatar,t.x=0,t.y=0,document.querySelector(".updateName").value=t.userName,startListening(t);let r=canvas.width,a=canvas.height,s=o.canvas;updateCanvasColor(o.bg,!1);for(let e=0;e<s.length;e++){let t=s[e];drawLine(t.x0*r,t.y0*a,t.x1*r,t.y1*a,t.color,!1,null,t.strokeWidth)}firstRun(o.game)}),socket.on("roomUsers",e=>{if(e.length>1?justDrawBtn.classList.add("hide"):justDrawBtn.classList.remove("hide"),document.querySelector(".player-count span").innerText=e.length,e=e.filter(e=>e.inAudio),usersInCall.innerText=`(${e.length})`,0===e.length)document.querySelector(".calls .warn").innerText="Looks like you are the only one here! You can join the room now, and others can join you whenever they want.",document.querySelector(".calls .block-title").style.display="none",document.querySelector(".calls .warn").style.display="block",document.querySelector(".calls .users").innerHTML="";else{document.querySelector(".calls .warn").style.display="none",document.querySelector(".calls .block-title").style.display="block";let t=e.map(e=>`<li id="u${e.id}-audio" ${e.muted?"class='muted'":""} style="border-bottom-color: ${e.avatar}"><span class="usr"><span class="mic"><i data-feather="mic"></i><i data-feather="mic-off"></i></span>${e.userName}${e.id===current.user.id?" (you)":""}</span>${e.id!==current.user.id?`<span class="silence" muted="false" data-user=${e.id}><i data-feather="volume-2"></i><i data-feather="volume-x"></i></span>`:""}</li>`).join(" ");document.querySelector(".calls .users").innerHTML=t,feather.replace()}}),socket.on("newUser",e=>{let t=document.getElementById(e.id);if(t||((t=document.createElement("div")).classList.add("user"),t.id=e.id,t.style.backgroundColor=e.avatar,t.style.display="none",document.body.appendChild(t)),"0"!==document.querySelector(".buttons .player-count .btn-label").innerText&&playAudio(["sounds/notif.mp3"]).play().volume(.3),showMessage(`<li class="status"><p>${e.userName} joined the room</p></li>`,!1),firstRunOpen&&2===firstRnPhase){document.querySelector("#first-run .firstRunPlayersList").innerHTML+=`<li>${e.userName} joined the room</li>`,document.querySelector("#first-run .start-fr").innerText="Let's play!"}}),socket.on("collided",e=>{playAudio(["sounds/oop.mp3"]).volume(.3).play(),document.body.classList.add("collided"),updateCanvasColor(e.bg,!1),showMessage(`<li class="status collision"><p>${e.p1.userName} & ${e.p2.userName} broke social distance!</p></li>`,!1),setTimeout(()=>{document.body.classList.remove("collided")},1e3)}),socket.on("playerDisconnect",e=>{document.getElementById(e.id)&&(document.getElementById(e.id).remove(),showMessage(`<li class="status"><p>${e.userName} left the room</p></li>`,!1))});let current={color:"black",user:""},drawing=!1;function startListening(e){current.user=e,canvas.addEventListener("mousedown",onMouseDown,!1),canvas.addEventListener("mouseup",onMouseUp,!1),canvas.addEventListener("mouseout",onMouseUp,!1),canvas.addEventListener("mousemove",throttle(onMouseMove,10),!1),canvas.addEventListener("touchstart",onMouseDown,!1),canvas.addEventListener("touchend",onMouseUp,!1),canvas.addEventListener("touchcancel",onMouseUp,!1),canvas.addEventListener("touchmove",throttle(onMouseMove,10),!1),colors.addEventListener("click",e=>{if(e.target.classList.contains("colors"))return;let t=e.target.className.split(" ")[1];if(current.color===t||!t)return;current.color=t,e.target.classList.add("active");let o=document.getElementsByClassName("color");for(let e=0;e<o.length;e++)o[e].classList.contains(current.color)||o[e].classList.remove("active")})}function drawLine(e,t,o,n,r,a,s,i){if(context.beginPath(),context.moveTo(e,t),context.lineTo(o,n),context.strokeStyle=r,context.lineWidth=i,context.lineCap="round",context.stroke(),context.closePath(),a){var l=canvas.width,c=canvas.height;s&&(user.style.left=s.x+"%",user.style.top=s.y+"%"),current.user.lastDraw=Date.now(),socket.emit("drawing",{x0:e/l,y0:t/c,x1:o/l,y1:n/c,strokeWidth:i,color:r,user:current.user})}}socket.on("drawing",onDrawingEvent),socket.on("userMoving",onUserEvent),window.addEventListener("resize",onResize,!1),onResize();let inviteFromTwitter=()=>{let e=`Join me on Social Distance Drawing! ðŸŽ¨ ${document.querySelector(".shareLink").value}`;window.open(`https://twitter.com/intent/tweet?text=${encodeURI(e)}&button_hashtag=SocialDistanceDrawing`)};function onMouseDown(e){drawing=!0,current.x=e.clientX||e.changedTouches[0].clientX,current.y=e.clientY||e.changedTouches[0].clientY}function onMouseUp(e){if(!drawing)return;drawing=!1;let t=getMousePosition(e.clientX,e.clientY);current.user.x=t[0],current.user.y=t[1],current.user.pX=e.clientX,current.user.pY=e.clientY;let o=e.clientX,n=e.clientY;e.touches&&(o=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY),drawLine(current.x,current.y,o,n,current.color,!0,current.user,brushSize)}function onMouseMove(e){let t=getMousePosition(e.clientX,e.clientY),o=[];e.touches&&(o=getMousePosition(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),user.style.left=(t[0]||o[0])+"%",user.style.top=(t[1]||o[1])+"%",current.user.x=t[0]||o[0],current.user.y=t[1]||o[1];let n=e.clientX,r=e.clientY;e.touches&&(n=e.changedTouches[0].clientX,r=e.changedTouches[0].clientY),current.user.pX=n,current.user.pY=r,drawing?(drawLine(current.x,current.y,n,r,current.color,!0,current.user,brushSize),current.x=n,current.y=r):socket.emit("userMoving",{user:current.user})}function throttle(e,t){var o=(new Date).getTime();return function(){var n=(new Date).getTime();n-o>=t&&(o=n,e.apply(null,arguments))}}function onUserEvent(e){canvas.width,canvas.height;if(document.getElementById(e.user.id)){let t=document.getElementById(e.user.id);t.style.display="block",t.style.left=e.user.x+"%",t.style.top=e.user.y+"%"}else{let t=document.createElement("div");t.classList.add("user"),t.id=e.user.id,t.style.backgroundColor=e.user.avatar,document.body.appendChild(t)}}function onDrawingEvent(e){var t=canvas.width,o=canvas.height;if(document.getElementById(e.user.id)){let t=document.getElementById(e.user.id);t.style.left=e.user.x+"%",t.style.top=e.user.y+"%"}else{let t=document.createElement("div");t.classList.add("user"),t.id=e.user.id,t.style.backgroundColor=e.user.color,document.body.appendChild(t)}drawLine(e.x0*t,e.y0*o,e.x1*t,e.y1*o,e.color,!1,null,e.strokeWidth)}function onResize(){let e=context.getImageData(0,0,canvas.width,canvas.height);canvas.width=window.innerWidth,canvas.height=window.innerHeight,context.putImageData(e,0,0)}function getMousePosition(e,t){return[e/window.innerWidth*100,t/window.innerHeight*100-2.5]}function toggleMouse(e){e.addEventListener("mouseenter",()=>{user.style.display="none"}),e.addEventListener("mouseleave",()=>{user.style.display="block"})}clear.addEventListener("click",()=>{socket.emit("clearCanvas",current.user)}),socket.on("clearCanvas",e=>{let{room:t,user:o}=e;updateCanvasColor(t.bg,!1),showMessage(`<li class="status"><p>${o.userName} cleared the canvas!</p></li>`,!1)}),lock.addEventListener("click",()=>{socket.emit("lockRoom",current.user)}),socket.on("joinFail",e=>{alert(e),window.location="/"}),socket.on("lockRoom",e=>{let{user:t,status:o}=e;o?(lock.classList.add("locked"),lock.querySelector("span").innerText="Unlock room",showMessage(`<li class="status"><p>${t.userName} locked the room!</p></li>`,!1)):(lock.classList.remove("locked"),lock.querySelector("span").innerText="Lock room",showMessage(`<li class="status"><p>${t.userName} unlocked the room!</p></li>`,!1))}),canvas.addEventListener("contextmenu",e=>e.preventDefault()),brushSizeControl.addEventListener("input",()=>{let e=parseInt(brushSizeControl.value);brushSize=e;let t=document.querySelector(".brush h4");t.innerHTML=e+"<span></span>",t.style.left=e+"%",t.style.transform="translateX(-50%) scale("+(1+e/100)+")",t.style.display="flex",document.querySelector(".brush h4 span").style.backgroundColor=current.color}),toggleMouse(toolbarButtons),toggleMouse(document.querySelector(".modal__overlay"));const pickr=Pickr.create({el:".toolbar .custom",theme:"nano",useAsButton:!0,swatches:["red","green","blue","#F44336","#E91E63","#9C27B0","#673AB7"],default:"purple",components:{preview:!0,opacity:!0,hue:!0,interaction:{hex:!0,rgba:!0,input:!0,cancel:!1,save:!1}}});pickr.on("show",()=>current.color="pruple"),pickr.on("change",e=>{let t=e.toHEXA().toString();document.querySelector(".toolbar .custom").classList.replace(current.color,t),current.color=t});const canvasPickr=Pickr.create({el:".toolbar .fill",theme:"nano",useAsButton:!0,swatches:["red","green","blue","#F44336","#E91E63","#9C27B0","#673AB7"],default:"purple",components:{preview:!0,opacity:!0,hue:!0,interaction:{hex:!0,rgba:!0,input:!0,cancel:!0,save:!0}},strings:{save:"Set canvas background",cancel:"Nevermind"}});function updateCanvasColor(e,t){if(context.fillStyle=e,context.fillRect(0,0,canvas.width,canvas.height),t){let t=document.querySelector(".eraser"),o=t.classList[1];t.classList.replace(o,e),t.classList.contains("active")&&(current.color=e)}}canvasPickr.on("save",e=>{confirm("Updating the background will clear the canvas. Are you sure you want to do this?")&&(updateCanvasColor(e=e.toHEXA().toString(),!0),canvasPickr.hide(),socket.emit("canvasColorChange",e))}),socket.on("canvasColorChange",e=>updateCanvasColor(e));let playerCount=document.querySelector(".player-count");playerCount.addEventListener("click",e=>{e.target.closest(".dropdown")||(playerCount.classList.toggle("open"),playerCount.classList.remove("show-unread"),settingsIcon.classList.toggle("display"))}),document.addEventListener("keydown",e=>{27===e.keyCode&&playerCount.classList.contains("open")&&(playerCount.classList.remove("open"),settingsIcon.classList.remove("display")),67===e.keyCode&&"input"!==e.target.localName&&(playerCount.classList.toggle("open"),settingsIcon.classList.toggle("display"),playerCount.classList.contains("open")&&document.querySelector(".chat-input input").focus())}),settingsIcon.addEventListener("click",e=>{playerCount.classList.toggle("hide-settings")}),document.addEventListener("click",e=>{!chatAutoClose||e.target.closest(".player-count")||e.target.closest(".settings")||playerCount.classList.contains("open")&&(playerCount.classList.remove("open"),settingsIcon.classList.toggle("display")),(e.target.classList.contains("tweet")||e.target.closest(".tweet"))&&inviteFromTwitter()});let shareLinkBox=document.querySelector(".shareLink");function inviteLink(e){e.value=window.location.href.split(/[?#]/)[0]+"?room="+room,e.addEventListener("focus",t=>{e.select()}),e.addEventListener("click",t=>{e.select()}),e.addEventListener("mouseup",e=>{e.preventDefault()})}inviteLink(shareLinkBox);let closeByClick,gameStop,inputBox=document.querySelector(".chat-input input"),msgSend=document.querySelector(".chat-send"),msgCont=document.querySelector(".player-count .inner");function sendMessage(){inputBox.value&&(socket.emit("chatMessage",{uid:current.user.id,userName:current.user.userName,accent:current.user.avatar,text:inputBox.value}),inputBox.value="",inputBox.focus())}function showMessage(e,t=!0){playerList.innerHTML+=e,msgCont.scrollTop=msgCont.scrollHeight,t&&!playerCount.classList.contains("open")&&playerCount.classList.add("show-unread")}function firstRun(e){let t=e.justDraw;!autoJoin||t?t?justDraw():(name||(firstRnContent.querySelector(".updateName")||1!==firstRnPhase||(firstRnContent.innerHTML+="<label>Set your name (we automagically picked one for you)</label><input type='text' placeholder='Enter your name' value='"+current.user.userName+"' class='updateName'/>"),updateNameHandler(document.querySelector(".modal__content .updateName"),void 0,()=>{document.querySelector(".start-fr").focus()})),MicroModal.show("first-run",{disableScroll:!0,disableFocus:!0,onClose:()=>socket.emit("joinGame")})):socket.emit("joinGame")}function updateNameHandler(e,t,o){t&&t.addEventListener("click",()=>{let t=e.value.replace(/\s/g,"");""!==t&&t!==current.user.userName?(socket.emit("updateName",t),playerCount.classList.toggle("hide-settings")):playerCount.classList.toggle("hide-settings")}),e&&e.addEventListener("keyup",e=>{13===e.keyCode&&(e.preventDefault(),o())})}msgSend.addEventListener("click",()=>sendMessage()),inputBox.addEventListener("keydown",e=>13===e.keyCode?sendMessage():null),socket.on("rcvMessage",e=>{document.getElementById(e.uid)&&(playerCount.classList.contains("open")||playAudio(["sounds/notif.mp3"]).play().volume(.3),showMessage(`<li class="${e.uid===current.user.id?"own":""}"><p class="msg" style="border-bottom: 5px solid ${e.accent}"><em>${e.userName}</em><span>${e.text}</span></p></li>`))}),updateNameHandler(document.querySelector(".updateName"),document.querySelector(".setNewName"),()=>{document.querySelector(".setNewName").click()}),socket.on("updatedUserName",e=>{let{oldName:t,user:o}=e;current.user.id===o.id&&(current.user=o,document.querySelector(".updateName").value=o.userName),showMessage(`<li class="status"><p>${t} changed their name to ${o.userName}</p></li>`,!1);let n=document.querySelector(".firstRunPlayersList");n&&(n.innerHTML+=`<li>${t} changed their name to ${o.userName}</li>`);let r=document.querySelector(`.calls .users #u${o.id}-audio .usr`);if(r){let e=document.querySelector(`.calls .users #u${o.id}-audio .usr .mic`);r.innerHTML=e.outerHTML+o.userName+`${current.user.id===o.id?" (you)":""}`}}),firstRnStartBtn.addEventListener("click",()=>{closeByClick=!1===closeByClick||void 0;let e=document.querySelector(".player-count span").innerText,t=document.querySelector(".modal__content .updateName");if(1===firstRnPhase&&t&&""!=t&&t.value.replace(/\s/g,"")!==current.user.userName&&socket.emit("updateName",t.value.replace(/\s/g,"")),1===firstRnPhase&&1===parseInt(e)){firstRnPhase+=1,firstRnHeader.innerText="Let's invite some friends!",firstRnContent.innerHTML='\n      <p>Looks like you are the only one here! The game is more fun with friends, so you can start off by inviting some with the following link:</p>\n      <input type="text" value="" readonly class="shareLink"/>\n      <span class="tweet"><i data-feather="twitter"></i><em>Invite friends from Twitter!</em></span>\n      <ul class="firstRunPlayersList"><li>Waiting for players to join...</li></ul>\n    ',document.querySelector("#first-run .start-fr").innerText="...or draw on your own",inviteLink(document.querySelector("#first-run .shareLink")),feather.replace()}else MicroModal.close(),socket.emit("joinGame")});let soundPlayed=!1,previousRound=0;function startTimer(e,t,o){if(gameStop)return;let n,r,a=e,s=setInterval(function(){if(n=parseInt(a/60,10),r=parseInt(a%60,10),n=n<10?"0"+n:n,r=r<10?"0"+r:r,t.textContent=n+":"+r,a<16&&!soundPlayed&&o){let e=document.querySelector(".buttons .timer audio");e&&e.remove();let t=document.querySelector(".buttons .timer");t.classList.add("yellow"),playAudio(["sounds/tick.mp3"],t).volume(userJoined?.1:.3).play(),isTickMuted&&(document.querySelector(".buttons .timer audio").muted=!0),soundPlayed=!0}--a<0&&(soundPlayed=!1,document.querySelector(".buttons .timer").classList.remove("yellow"),void 0===o&&5===previousRound&&(finishGameUI(),socket.emit("requestFinish")),o?(previousRound=o,nextRound(o)):(MicroModal.close(),socket.emit("nextRound")),clearInterval(s)),gameStop&&clearInterval(s)},1e3)}function startGame(e){document.querySelector(".buttons .btn.play-game").classList.add("hide");let t=Math.abs(Date.now()-e.timer)/1e3;if(startTimer(roundDuration-t,document.querySelector(".timer span t"),e.round),document.querySelector(".timer span em").innerText=`(round ${e.round})`,document.querySelector(".timer i").innerText=`draw ${e.currentlyDrawing}`,""===e.currentlyDrawing)return void finishGameUI();let o=document.querySelector(".currently-drawing");o.innerHTML=`<em>draw</em><span>${e.currentlyDrawing}</span>`,o.classList.add("show"),setTimeout(()=>{o.classList.remove("show")},3e3)}function finishGameUI(){document.querySelector(".buttons .btn.play-game").classList.remove("hide");let e=document.querySelector(".currently-drawing");e.innerHTML='<em>game finished</em><span>hit "play game" or <i data-feather="crosshair"></i> to start again</span>',e.classList.add("show"),feather.replace(),setTimeout(()=>{e.classList.remove("show")},3e3)}function nextRound(e){let t=document.querySelector(".player-count span").innerText;if(parseInt(t)<=minUsersNeededForVoting)return e<5?void socket.emit("nextRound"):(socket.emit("requestFinish"),void justDraw());document.querySelector(".modal__container").classList.add("leaderboard"),document.querySelector(".modal__overlay").classList.remove("normal"),document.querySelector(".modal__overlay").classList.add("side"),document.querySelector(".modal__footer").innerHTML="<p>Waiting for other players to vote. You can keep drawing in the meantime :)</p>",firstRnHeader.innerText="Choose a winner for round "+e,showRanks(!0,e),startTimer(waitTime,document.querySelector(".timer span t")),document.querySelector(".timer span em").innerText="(waiting)",document.querySelector(".timer i").innerText="draw anything",MicroModal.show("first-run",{disableScroll:!0,disableFocus:!0})}function showRanks(e,t){firstRnPhase=3,socket.emit("getPlayerList"),socket.on("playersList",o=>{let{users:n,ranks:r}=o;Object.keys(r).map(e=>{let t=n.find(t=>!!t&&t.id===e);t||0==r[e]?t&&(t.wins=r[e]):n[n.length+1]={userName:"disconnected-user",id:e,wins:r[e],disconnected:!0}}),n.sort((e,t)=>t.wins-e.wins);let a="";e?(a="<ul class='vote-players'>",a+=`${n.map((e,t)=>e.disconnected||e.id===current.user.id?"":`<li class="player" playerId="${e.id}"><input type="radio" id="${t}" name="vote" value="${e.id}"><label for="${t}">${e.userName}<span><em>ðŸ‘‘</em>${e.wins}</span></label></li>`).join("")}`,a+="</ul>",a+="<button class='submit-vote btn-d'>Submit vote</button>"):(a="<ul class='leaderboard-players'>",a+=`${n.map((e,t)=>`<li class="player ${0===t&e.wins>0?"champ":""}" playerId="${e.id}">${e.userName}<span><em>ðŸ‘‘</em>${e.wins}</span></li>`).join("")}`,a+="</ul>"),firstRnContent.innerHTML=a;let s=document.querySelector(".submit-vote");s&&s.addEventListener("click",e=>{MicroModal.close(),socket.emit("votePlayer",{playerId:document.querySelector("input[name='vote']:checked").value,round:t})})})}function justDraw(e){document.querySelector(".timer").classList.add("hide"),gameStop=!0,socket.emit("justDraw",!0),e&&document.querySelector(".play-game").classList.remove("hide")}socket.on("joinGame",e=>{6!==e.round&&startGame(e)}),socket.on("skipRoundWait",()=>{MicroModal.close(),socket.emit("nextRound")}),justDrawBtn.addEventListener("click",()=>{document.querySelector(".play-game").classList.remove("hide"),justDrawBtn.classList.add("hide"),document.querySelector(".currently-drawing").style.display="none",justDraw()}),document.querySelector(".play-game").addEventListener("click",()=>{confirm("Are you sure you want to start a new game? This will refresh the page.")&&(socket.emit("justDraw",!1),socket.emit("reloadGame"))}),socket.on("reloadGame",()=>{-1===window.location.href.indexOf("name=")?window.location.href+=`&name=${current.user.userName}${autoJoin?"":userJoined?"&autoJoin=true":""}`:window.location.href+=`${autoJoin?"":userJoined?"&autoJoin=true":""}`}),socket.on("gameFinish",e=>{let t=document.querySelector(".player-count span").innerText,o=!1;Object.values(e.ranks).map(e=>{0!=e&&(o=!0)}),finishGameUI(),parseInt(t)<=minUsersNeededForVoting&&!o||(firstRnHeader.innerText="Winner winner chicken dinner",document.querySelector(".modal__footer").innerHTML="You can go back to just drawing now :)<button class='btn-d play-gamed'>Start new game</button>&nbsp;<button class='btn-d' data-micromodal-close=''>Close</button>",document.querySelector(".play-gamed").addEventListener("click",()=>{document.querySelector(".play-game").click()}),showRanks(!1),MicroModal.show("first-run",{disableScroll:!0,disableFocus:!0}),justDraw(!0))});let chatCloseBoxes=document.querySelectorAll("input[name='chatClose']"),chatCloseBtn=document.querySelector("input[name='chatClose']");document.querySelector(".player-count").addEventListener("change",e=>{"chatClose"===e.target.name&&(localStorage.setItem("sddChat",e.target.checked),changeChatAutoInputs(e.target.checked))});let isAutoClose="true"===localStorage.getItem("sddChat");function changeChatAutoInputs(e){chatAutoClose=e;for(let t=0;t<chatCloseBoxes.length;t++){chatCloseBoxes[t].checked=e}}function dropdown(e,t){e.addEventListener("click",t=>{t.target.closest(".dropdown")||e.classList.toggle("open")}),document.addEventListener("click",o=>{o.target.closest(t)||e.classList.contains("open")&&e.classList.remove("open")})}changeChatAutoInputs(isAutoClose);let tickMute=document.querySelector(".timer e");isTickMuted&&document.querySelector(".timer").classList.add("muted"),tickMute.addEventListener("click",()=>{let e="true"===localStorage.getItem("sddMute"),t=document.querySelector(".buttons .timer audio");e?(localStorage.setItem("sddMute","false"),document.querySelector(".timer").classList.remove("muted"),t.muted=!1,isTickMuted=!1):(localStorage.setItem("sddMute","true"),t.muted=!0,document.querySelector(".timer").classList.add("muted"),isTickMuted=!0)});